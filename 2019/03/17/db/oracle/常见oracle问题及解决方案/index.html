<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="@[toc] 连接数设置、字符集、端口监听、日期格式  折叠源码1234567891011121314151617181920212223242526271. 用sys登录sql plus:usename: sys as sysdbapassword: ****2. 查看最大连接数： select value from V$parameter where name=&apos;processes&apos;;3. 查">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2019/03/17/db/oracle/常见oracle问题及解决方案/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="@[toc] 连接数设置、字符集、端口监听、日期格式  折叠源码1234567891011121314151617181920212223242526271. 用sys登录sql plus:usename: sys as sysdbapassword: ****2. 查看最大连接数： select value from V$parameter where name=&apos;processes&apos;;3. 查">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-03-17T04:23:40.896Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="@[toc] 连接数设置、字符集、端口监听、日期格式  折叠源码1234567891011121314151617181920212223242526271. 用sys登录sql plus:usename: sys as sysdbapassword: ****2. 查看最大连接数： select value from V$parameter where name=&apos;processes&apos;;3. 查">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-db/oracle/常见oracle问题及解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/17/db/oracle/常见oracle问题及解决方案/" class="article-date">
  <time datetime="2019-03-17T05:43:02.798Z" itemprop="datePublished">2019-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>@[toc]</p>
<h3 id="连接数设置、字符集、端口监听、日期格式-折叠源码"><a href="#连接数设置、字符集、端口监听、日期格式-折叠源码" class="headerlink" title="连接数设置、字符集、端口监听、日期格式  折叠源码"></a>连接数设置、字符集、端口监听、日期格式  折叠源码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1. 用sys登录sql plus:</span><br><span class="line">usename: sys as sysdba</span><br><span class="line">password: ****</span><br><span class="line">2. 查看最大连接数： <span class="keyword">select</span> <span class="keyword">value</span> <span class="keyword">from</span> V$parameter <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'processes'</span>;</span><br><span class="line">3. 查看当前连接数： <span class="keyword">select</span> <span class="keyword">count</span> (*) <span class="keyword">from</span> V$process;</span><br><span class="line">4. 把最大连接数改成300：<span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> processes=<span class="number">300</span> <span class="keyword">scope</span>=<span class="keyword">spfile</span>;</span><br><span class="line">5. 重启DB: shutdown immediate;</span><br><span class="line">startup;</span><br><span class="line"> </span><br><span class="line">端口监听</span><br><span class="line">修改文件：%oracle_home%\NETWORK\ADMIN\listener.ora</span><br><span class="line">新增host ： 主机名、ip</span><br><span class="line">(ADDRESS = (PROTOCOL = TCP)(HOST = leiax)(PORT = 1521))</span><br><span class="line">cmd中：</span><br><span class="line">lsnrctl</span><br><span class="line">然后可以进行监听的开启<span class="keyword">start</span>，结束<span class="keyword">stop</span>，状态查询<span class="keyword">status</span></span><br><span class="line">修改文件后需要对监听进行重启，且需要一段时间才会生效</span><br><span class="line"></span><br><span class="line">服务的创建：</span><br><span class="line">sc <span class="keyword">delete</span> OracleMTSRecoveryService</span><br><span class="line">sc <span class="keyword">create</span> OracleMTSRecoveryService binPath= <span class="string">"D:\javaSoft\oracle1\soft\bin\omtsreco.exe"</span></span><br><span class="line"></span><br><span class="line">日期格式修改</span><br><span class="line">查看日期格式：<span class="keyword">select</span> <span class="keyword">sysdate</span> <span class="keyword">from</span> dual;</span><br><span class="line">修改日期格式：<span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> nls_date_format = <span class="string">'yyyy-mm-dd hh24:mi:ss'</span>;</span><br><span class="line">重启DB: shutdown immediate;</span><br><span class="line">        startup;</span><br></pre></td></tr></table></figure>
<h3 id="oracle数据块损坏-折叠源码"><a href="#oracle数据块损坏-折叠源码" class="headerlink" title="oracle数据块损坏  折叠源码"></a>oracle数据块损坏  折叠源码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">检测方式：</span><br><span class="line">    管理员登录sqlplus： 输入：<span class="keyword">show</span> parameter db_block_check</span><br><span class="line">         </span><br><span class="line">        db_block_checking       逻辑一致性检查 默认不开启</span><br><span class="line">        db_block_checksum       数据库对块的物理一致性检查    默认开启</span><br><span class="line"></span><br><span class="line"><span class="keyword">oracle</span> 将坏块分为物理和逻辑损坏两种，那么当<span class="keyword">oracle</span>发现物理或者逻辑损坏之后是如何标记数据块从而使之后的操作知道该块是损坏块的那？</span><br><span class="line">对于物理损坏，<span class="keyword">oracle</span>不会进行任何的处理，在进行后续处理时<span class="keyword">oracle</span>会重新计算<span class="keyword">checksum</span>，只要发现<span class="keyword">checksum</span>不一致则认为该块时物理损坏，并抛出<span class="number">01578</span>错误。</span><br><span class="line">对于逻辑损坏，当<span class="keyword">oracle</span>第一次对数据块进行逻辑检测时，会抛出ora <span class="number">600</span>等错误，并修改数据块中的标记位，当下次访问该数据块时，<span class="keyword">oracle</span>检测标志位，如果发现标志位以置为逻辑损坏，则抛出ora <span class="number">01578</span>错误。当使用DBMS_REPAIR对坏块进行修改时，如果时物理损坏不作任何处理，如果时逻辑损坏，修改数据块的标志位。</span><br><span class="line">dbv工具检测文件：</span><br><span class="line">cmd下执行 ：  dbv <span class="keyword">file</span>=D:\javaSoft\<span class="keyword">oracle</span>\<span class="keyword">oradata</span>\orcl\SYSAUX01.DBF</span><br><span class="line"> </span><br><span class="line">rman工具：</span><br><span class="line">cmd中输入： RMAN                    进入rman</span><br><span class="line">rman连接数据库： <span class="keyword">connect</span> target <span class="keyword">system</span>/U_tywg_2008</span><br><span class="line">备份文件： <span class="keyword">backup</span> <span class="keyword">validate</span> <span class="keyword">datafile</span> <span class="number">6</span>;</span><br><span class="line">   </span><br><span class="line">问题：</span><br><span class="line">2017-09-11 21:22:51,208 INFO  [org.jboss.resource.adapter.jdbc.local.LocalConnection] Refactored SQLException:ORACLE:ORA-01578: ORACLE 数据块损坏 (文件号 66, 块号 362498)</span><br><span class="line">ORA-01110: 数据文件 66: '/home/emsuep/u31/UEP4X_FM_NOTIFICATION3.DBF'</span><br><span class="line">;72000;1578;java.sql.SQLException: ORA-01578: ORACLE 数据块损坏 (文件号 66, 块号 362498)</span><br><span class="line">ORA-01110: 数据文件 66: '/home/emsuep/u31/UEP4X_FM_NOTIFICATION3.DBF'</span><br><span class="line"></span><br><span class="line">错误：在 exp 时出现以下错误：</span><br><span class="line">EXP-00056: 遇到 ORACLE 错误 1578</span><br><span class="line">ORA-01578: ORACLE 数据块损坏（文件号4，块号65）</span><br><span class="line">ORA-01110: 数据文件 4: ’E:\ORACLE\ORADATA\USERS.DBF’</span><br><span class="line"> </span><br><span class="line">措施：</span><br><span class="line"><span class="comment">-- 1. 检查损坏的对象</span></span><br><span class="line"><span class="keyword">SELECT</span> tablespace_name, segment_type, owner, segment_name</span><br><span class="line">            <span class="keyword">FROM</span> dba_extents</span><br><span class="line">           <span class="keyword">WHERE</span> file_id = <span class="number">4</span></span><br><span class="line">             <span class="keyword">and</span> <span class="number">65</span> <span class="keyword">between</span> block_id <span class="keyword">AND</span> block_id + blocks - <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 2. 设置内部事件，使exp跳过损坏的block</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> <span class="keyword">EVENTS</span>=’<span class="number">10231</span> <span class="keyword">trace</span> <span class="keyword">name</span> <span class="keyword">context</span> forever,<span class="keyword">level</span> <span class="number">10</span>’ ; </span><br><span class="line"><span class="comment">-- 3. 导出表</span></span><br><span class="line">exp user1/passwd1 file=t1.dmp tables=t1</span><br><span class="line"><span class="comment">-- 4. 删除有坏块的表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t1 <span class="keyword">purge</span>;</span><br><span class="line"><span class="comment">-- 5. 导入表</span></span><br><span class="line">imp user1/passwd1 file=t1.dmp tables=t1</span><br><span class="line"><span class="comment">-- 6. 清除跟踪事件</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> <span class="keyword">EVENTS</span>=’<span class="number">10231</span> <span class="keyword">trace</span> <span class="keyword">name</span> <span class="keyword">context</span> <span class="keyword">off</span>’ ;</span><br><span class="line"> </span><br><span class="line">缺点：坏块处的数据会丢失</span><br></pre></td></tr></table></figure>
<h3 id="oracle表空间容量查询"><a href="#oracle表空间容量查询" class="headerlink" title="oracle表空间容量查询"></a>oracle表空间容量查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1、查看所有表空间大小、剩余量：</span><br><span class="line"><span class="keyword">select</span> dbf.tablespace_name,</span><br><span class="line">dbf.totalspace <span class="string">"总量(M)"</span>,</span><br><span class="line">dbf.totalblocks <span class="keyword">as</span> 总块数,</span><br><span class="line">dfs.freespace <span class="string">"剩余总量(M)"</span>,</span><br><span class="line">dfs.freeblocks <span class="string">"剩余块数"</span>,</span><br><span class="line">(dfs.freespace / dbf.totalspace) * <span class="number">100</span> <span class="string">"空闲比例"</span></span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> t.tablespace_name,</span><br><span class="line"><span class="keyword">sum</span>(t.bytes) / <span class="number">1024</span> / <span class="number">1024</span> totalspace,</span><br><span class="line"><span class="keyword">sum</span>(t.blocks) totalblocks</span><br><span class="line"><span class="keyword">from</span> dba_data_files t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> t.tablespace_name) dbf,</span><br><span class="line">(<span class="keyword">select</span> tt.tablespace_name,</span><br><span class="line"><span class="keyword">sum</span>(tt.bytes) / <span class="number">1024</span> / <span class="number">1024</span> freespace,</span><br><span class="line"><span class="keyword">sum</span>(tt.blocks) freeblocks</span><br><span class="line"><span class="keyword">from</span> dba_free_space tt</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> tt.tablespace_name) dfs</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">trim</span>(dbf.tablespace_name) = <span class="keyword">trim</span>(dfs.tablespace_name);</span><br><span class="line"> </span><br><span class="line">2、查看当前用户各表所占表空间</span><br><span class="line"><span class="keyword">Select</span> Segment_Name,<span class="keyword">Sum</span>(<span class="keyword">bytes</span>)/<span class="number">1024</span>/<span class="number">1024</span> <span class="keyword">From</span> User_Extents <span class="keyword">Group</span> <span class="keyword">By</span> Segment_Name</span><br><span class="line"><span class="number">3.</span>  使用如下语句查看一下谁在用临时段</span><br><span class="line"><span class="keyword">SELECT</span> se.username, se.SID, se.serial<span class="comment">#, se.sql_address, se.machine, se.program, su.TABLESPACE,  su.segtype,  su.CONTENTS</span></span><br><span class="line"><span class="keyword">FROM</span> v$<span class="keyword">session</span> se, v$sort_usage su</span><br><span class="line">    <span class="keyword">WHERE</span> se.saddr = su.session_addr;</span><br></pre></td></tr></table></figure>
<h3 id="连接数设置、字符集、端口监听、日期格式表被其他用户占用，处理方法"><a href="#连接数设置、字符集、端口监听、日期格式表被其他用户占用，处理方法" class="headerlink" title="连接数设置、字符集、端口监听、日期格式表被其他用户占用，处理方法"></a>连接数设置、字符集、端口监听、日期格式表被其他用户占用，处理方法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--用于查看数据库锁,诊断锁的来源及类型</span></span><br><span class="line"><span class="keyword">select</span> object_id,session_id,locked_mode <span class="keyword">from</span> v$locked_object;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">select</span> b.owner,b.object_name,l.session_id,l.locked_mode <span class="keyword">from</span> v$locked_object l, dba_objects b</span><br><span class="line">    <span class="keyword">where</span> b.object_id=l.object_id;</span><br><span class="line"> </span><br><span class="line"><span class="comment">--找出数据库的serial#,以备杀死</span></span><br><span class="line"><span class="keyword">select</span> t2.username,t2.sid,t2.serial<span class="comment">#,t2.logon_time from v$locked_object t1,v$session t2</span></span><br><span class="line">    <span class="keyword">where</span> t1.session_id=t2.sid <span class="keyword">order</span> <span class="keyword">by</span> t2.logon_time;</span><br><span class="line"><span class="comment">--杀死该session</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">kill</span> <span class="keyword">session</span> <span class="string">'sid,serial#'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="触发器失效"><a href="#触发器失效" class="headerlink" title="触发器失效"></a>触发器失效</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">Oracle数据库UserA用户权限丢失及触发器失效解决方法</span><br><span class="line"> </span><br><span class="line">停止EMS网管服务，保证EMS网管数据库没有被访问使用，然后执行如下步骤；</span><br><span class="line"> </span><br><span class="line">使用system用户登录数据库（使用sqlplus，PL/SQL Developer,SQL Developer等工具皆可），密码由现场人员输入，执行以下sql：</span><br><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> DBA_sys_privs <span class="keyword">where</span> grantee=<span class="string">'UserA'</span>;</span><br><span class="line">查看UserA用户是否有如下第2步所示的所有权限，如果有则跳过第2步，若没有则继续第2步。</span><br><span class="line"> </span><br><span class="line">用system用户执行以下sql添加用户权限：</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UNLIMITED</span> <span class="keyword">TABLESPACE</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">SESSION</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> CLUSTER <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">TYPE</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">OPERATOR</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">INDEXTYPE</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span>  <span class="keyword">VIEW</span> <span class="keyword">TO</span> UserA;</span><br><span class="line"> </span><br><span class="line">请用UserA/password登录数据库，执行以下查询：</span><br><span class="line"><span class="keyword">Select</span> OBJECT_NAME, <span class="keyword">STATUS</span></span><br><span class="line">  <span class="keyword">From</span> user_objects</span><br><span class="line"> <span class="keyword">Where</span> object_type = <span class="string">'TRIGGER'</span></span><br><span class="line">   <span class="keyword">and</span> (object_name = <span class="string">'TALARMRULE_T'</span> <span class="keyword">OR</span> object_name = <span class="string">'TTALARMBOX_T'</span>);</span><br><span class="line"> </span><br><span class="line">如果查询结果中，'TALARMRULE_T'或者object_name = 'TTALARMBOX_T'为INVALID，则表示触发器已失效，继续执行以下检查步骤。否则忽略后续步骤。</span><br><span class="line"> </span><br><span class="line">仍旧用UserA/password执行以下查询：</span><br><span class="line"><span class="keyword">SELECT</span> sequence_name, LAST_NUMBER</span><br><span class="line"><span class="keyword">FROM</span> user_sequences</span><br><span class="line"><span class="keyword">WHERE</span> sequence_name = <span class="string">'TALARMRULE_S'</span></span><br><span class="line"><span class="keyword">or</span> sequence_name = <span class="string">'TALARMBOX_S'</span>;</span><br><span class="line">如果查询结果没有'TALARMRULE_S'或者'TALARMBOX_S'，则表示序列已经丢失，触发器引用了序列，因此触发器也失效了，需要继续执行后续步骤；</span><br><span class="line">如果查询结果中'TALARMRULE_S'和'TALARMBOX_S'均存在，则忽略后续步骤。</span><br><span class="line"> </span><br><span class="line">用UserA用户执行以下sql重建序列和触发器：</span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> TALARMRULE_S</span><br><span class="line">    <span class="keyword">INCREMENT</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">1</span></span><br><span class="line">    MAXVALUE <span class="number">99999</span> <span class="keyword">MINVALUE</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">CYCLE</span></span><br><span class="line">    <span class="keyword">CACHE</span> <span class="number">20</span></span><br><span class="line">    <span class="keyword">ORDER</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">TRIGGER</span> TALARMRULE_T <span class="keyword">BEFORE</span> <span class="keyword">INSERT</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="string">"ALARMRULE"</span></span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line">    <span class="keyword">DECLARE</span> newID <span class="built_in">INTEGER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">select</span> TALARMRULE_S.nextval <span class="keyword">into</span> newID</span><br><span class="line">    <span class="keyword">from</span> dual;</span><br><span class="line">    :new.Id := newID;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> TALARMBOX_S</span><br><span class="line">    <span class="keyword">INCREMENT</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">1</span></span><br><span class="line">    MAXVALUE <span class="number">99999</span> <span class="keyword">MINVALUE</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">CYCLE</span></span><br><span class="line">    <span class="keyword">CACHE</span> <span class="number">20</span></span><br><span class="line">    <span class="keyword">ORDER</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">TRIGGER</span> TTALARMBOX_T <span class="keyword">BEFORE</span> <span class="keyword">INSERT</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="string">"ALARMBOX"</span></span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line">    <span class="keyword">DECLARE</span> newID <span class="built_in">INTEGER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">select</span> TALARMBOX_S.nextval <span class="keyword">into</span> newID</span><br><span class="line">    <span class="keyword">from</span> dual;</span><br><span class="line">    :new.Id := newID;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br><span class="line">重复步骤3，检查触发器状态是否已正常，如已经正常则执行下面的步骤，否则联系开发同事支持。</span><br><span class="line">用UserA用户调用存储过程：</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">ruleandboxidsequencematch;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br><span class="line"> </span><br><span class="line">重复步骤4，记下序列的LAST_NUMBER值，再执行以下sql：</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>) <span class="keyword">from</span> alarmrule;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>) <span class="keyword">from</span> alarmbox;</span><br><span class="line">如果序列的当前值大于ID的最大值，就说明存储过程执行成功，至此问题解决。</span><br></pre></td></tr></table></figure>
<h3 id="oracle中查看bolb格式的字段"><a href="#oracle中查看bolb格式的字段" class="headerlink" title="oracle中查看bolb格式的字段,"></a>oracle中查看bolb格式的字段,</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pl/sql 中可以直接查询出结果</span><br><span class="line">naviact的话: <span class="keyword">SELECT</span> UTL_RAW.CAST_TO_VARCHAR2(RULEDATA) <span class="keyword">FROM</span> ALARMRULE;</span><br><span class="line">    或者 选中 blob字段，然后点击工具图标栏的 备注 按钮</span><br></pre></td></tr></table></figure>
<h3 id="oracel-数据库问题-ORA-12547-ORA-12571-解决记录"><a href="#oracel-数据库问题-ORA-12547-ORA-12571-解决记录" class="headerlink" title="oracel 数据库问题 ORA-12547 ORA-12571 解决记录"></a>oracel 数据库问题 ORA-12547 ORA-12571 解决记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. ORA-12547 ORA-12571</span><br><span class="line"> </span><br><span class="line">oracel 数据库问题 ORA-12547 ORA-12571 解决记录</span><br><span class="line">Oracel 业务数据库近期频繁出现：ORA-12547：TNS：lost contact  和 ORA-12571：TNS：packet writer failure 错误</span><br><span class="line">排除了端口及监听程序的问题，最终解决办法：</span><br><span class="line">将Sqlnet.ora文件中的SQLNET.AUTHENTICATION_SERVICES= (NTS)修改为SQLNET.AUTHENTICATION_SERVICES= (NONE)</span><br><span class="line">修改后上述错误解决，但又出现连接非常慢的问题，连接成功时间超过10分钟，</span><br><span class="line">经过漫长的检查，发现是Oracle相关日志文件过大，导致后续日志信息写入时间过长导致，解决办法：</span><br><span class="line">备份原日志文件，并清空日志文件，相关日志文件如下：</span><br><span class="line">X:\app\Administrator\diag\tnslsnr\xx-datebase-1\listener\trace\listener.log</span><br><span class="line">X:\app\Administrator\product\11.2.0\dbhome_2\oc4j\j2ee\OC4J_DBConsole_xx-datebase-1_orcl\log\em-application.log</span><br><span class="line">其中xx-datebase-1代表数据库服务器名。</span><br><span class="line">数据库问题的出现有很多原因，以上方法并不代表同样的问题在其他环境下有效。防止踩坑......</span><br><span class="line"> </span><br><span class="line">2. 连接oracle数据库出现oracle ORA-12526: TNS: 监听程序: 所有适用例程都处于受限</span><br><span class="line">今天使用PL/SQL远程连接oracle数据库出现oracle ORA-12526: TNS: 监听程序: 所有适用例程都处于受限模式。</span><br><span class="line">查了下原来之前改字符集时执行了：<span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">ENABLE</span> <span class="keyword">RESTRICTED</span> <span class="keyword">SESSION</span>；</span><br><span class="line">导致受限</span><br><span class="line">解决办法：使用系统管理员身份运行以下一段代码</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">DISABLE</span> <span class="keyword">RESTRICTED</span> <span class="keyword">SESSION</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Oracle在更改机器名后服务无法启动的解决方法"><a href="#Oracle在更改机器名后服务无法启动的解决方法" class="headerlink" title="Oracle在更改机器名后服务无法启动的解决方法"></a>Oracle在更改机器名后服务无法启动的解决方法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Oracle改变机器名后会导致服务无法正常启动，可以通过下列操作解决：</span><br><span class="line">1.oracle\product\10.2.0\db_3\network\ADMIN目录下，listener.ora文件中的LISTENER 改为你的新机器名，如果有域名的话加上域名；</span><br><span class="line">tnsnames.ora中ORCL改为你的新机器名，如果有域名的话加上域名；</span><br><span class="line">2.oracle\product\10.2.0\db_3\下有个以你”旧机器名_orcl"为文件名的文件夹，把旧机器名改为新的名字</span><br><span class="line">3.oracle\product\10.2.0\db_3\oc4j\j2ee有个文件夹为OC4J_DBConsole_旧机器名_orcl，把旧机器名改掉</span><br><span class="line">4.CMD下执行emca -reops recreate 重建EM资料库：</span><br><span class="line">5.执行emca -config dbcontrol db</span><br><span class="line">执行4,5时会让你填写：</span><br><span class="line">SID:[即数据库名，默认orcl即可]</span><br><span class="line">监听程序端口号：[默认填1521]</span><br><span class="line">SYS,DBSNMP,SYSMAN的口令</span><br></pre></td></tr></table></figure>
<h3 id="oracle查询存储过程，视图，表的创建语句"><a href="#oracle查询存储过程，视图，表的创建语句" class="headerlink" title="oracle查询存储过程，视图，表的创建语句"></a>oracle查询存储过程，视图，表的创建语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查询存储过程：</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">text</span> <span class="keyword">from</span> all_source <span class="keyword">where</span> owner=<span class="keyword">user</span> <span class="keyword">and</span> <span class="keyword">name</span>=<span class="string">'SP_CREATEVIEW'</span>;</span><br><span class="line">查询视图：</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">LONG</span> <span class="number">60000</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">text</span> <span class="keyword">from</span> user_views <span class="keyword">where</span> view_name = <span class="string">'V_FM_COMMON_CURRENTALARM'</span>;</span><br><span class="line">在显示不完全的情况下添加：<span class="keyword">SET</span> <span class="keyword">LONG</span> <span class="number">60000</span> 语句</span><br></pre></td></tr></table></figure>
<h3 id="oracle删除"><a href="#oracle删除" class="headerlink" title="oracle删除"></a>oracle删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Windows 平台 </span><br><span class="line">  因为oracle在Windows下的卸载颇有一些麻烦，如果不能完全卸载有可能影响将来的再次安装！常规卸载方法是运行Oracle的自带的卸载程序，可遗憾的是我在卸载时总不能完全卸载，当我再次安装Oracle时，就会出现莫名其妙的问题，并且这种卸载方式比较麻烦，比较慢，下面我介绍一种比较快并且能够彻底卸载Oracle的方法。     </span><br><span class="line">1.关闭oracle所有的服务。可以在windows的服务管理器中关闭；</span><br><span class="line">2.打开注册表：regedit 打开路径：  HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\  </span><br><span class="line">删除该路径下的所有以oracle开始的服务名称，这个键是标识Oracle在windows下注册的各种服务！</span><br><span class="line">3.打开注册表，找到路径：  HKEY_LOCAL_MACHINE\SOFTWARE\ORACLE </span><br><span class="line">删除该oracle目录，该目录下注册着Oracle数据库的软件安装信息。</span><br><span class="line">4.删除注册的oracle事件日志，打开注册表</span><br><span class="line"> HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application  </span><br><span class="line">删除注册表的以oracle开头的所有项目。 </span><br><span class="line">5.删除环境变量path中关于oracle的内容。</span><br><span class="line">鼠标右键右单击“我的电脑属性高级环境变量PATH 变量。   </span><br><span class="line">删除Oracle在该值中的内容。注意:path中记录着一堆操作系统的目录，在windows中各个目录之间使用分号（; ）隔开的，删除时注意。</span><br><span class="line">建议：删除PATH环境变量中关于Oracle的值时，将该值全部拷贝到文本器中，找到对应的Oracle的值，删除后，再拷贝修改的串，粘贴到PATH环境变量中，这样相对而言比较安全。 </span><br><span class="line"> 6.重新启动操作系统。 </span><br><span class="line">以上1~5个步骤操作完毕后，重新启动操作系统。</span><br><span class="line">7.重启操作系统后各种Oracle相关的进程都不会加载了。</span><br><span class="line">这时删除Oracle_Home下的所有数据。（Oracle_Home指Oracle程序的安装目录） </span><br><span class="line">8.删除C:\Program Files下oracle目录。   （该目录视Oracle安装所在路径而定） </span><br><span class="line">9.删除开始菜单下oracle项，</span><br><span class="line">如：  C:\Documents and Settings\All Users\「开始」菜单\程序\Oracle - Ora10g</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/17/db/oracle/常见oracle问题及解决方案/" data-id="cjtchv22q000acwvz1rbqjy66" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/03/17/db/postgresql/postgresql安装配置/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2019/03/17/db/oracle/oracle的删除/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/17/spring/spring中获取项目根路径/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/03/17/python/函数/装饰器/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/03/17/python/函数/偏函数/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/03/17/python/readme/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/03/17/linux/Ubuntu中创建idea快捷方式/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>